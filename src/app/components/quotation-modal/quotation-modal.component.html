<!-- ANCHOR: MODAL_CONTAINER -->
<div
  class="fixed inset-0 z-[100] flex items-center justify-center p-4 transition-opacity duration-300"
  [class.pointer-events-none]="!uiService.isQuotationModalOpen()"
  [class.opacity-0]="!uiService.isQuotationModalOpen()"
  [class.opacity-100]="uiService.isQuotationModalOpen()"
>
  <!-- Backstop / Glassmorphism Overlay -->
  <div
    class="absolute inset-0 bg-zinc-900/60 backdrop-blur-md transition-opacity duration-300"
    (click)="close()"
  ></div>

  <!-- Modal Content -->
  <div
    class="relative w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden transform transition-all duration-300 ease-out"
    [class.scale-100]="uiService.isQuotationModalOpen()"
    [class.opacity-100]="uiService.isQuotationModalOpen()"
    [class.scale-95]="!uiService.isQuotationModalOpen()"
    [class.opacity-0]="!uiService.isQuotationModalOpen()"
    [class.translate-y-0]="uiService.isQuotationModalOpen()"
    [class.translate-y-4]="!uiService.isQuotationModalOpen()"
  >
    <!-- Close Button -->
    <button
      (click)="close()"
      class="absolute top-4 right-4 p-2 rounded-full hover:bg-zinc-100 text-zinc-400 hover:text-zinc-600 transition-colors z-10"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
        class="w-5 h-5"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- View Switcher -->
    @if (viewState() === 'form') {
      <div class="p-8 md:p-10 animate-fade-in">
        <h2 class="text-2xl font-bold text-zinc-900 mb-2">Personaliza tu éxito visual</h2>
        <p class="text-zinc-500 mb-8 text-sm">
          Completa los detalles para recibir una propuesta personalizada hoy mismo.
        </p>

        <form (ngSubmit)="submitForm()" #quotationForm="ngForm" class="space-y-6">
          <div class="space-y-2">
            <label class="text-xs font-semibold text-zinc-500 uppercase tracking-wider"
              >Nombre Completo</label
            >
            <input
              type="text"
              [(ngModel)]="formData.name"
              name="name"
              required
              placeholder="Ej. Alex Thompson"
              class="w-full px-4 py-3 bg-zinc-50 border border-zinc-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all placeholder:text-zinc-300"
            />
          </div>

          <div class="space-y-2">
            <label class="text-xs font-semibold text-zinc-500 uppercase tracking-wider"
              >Correo Electrónico</label
            >
            <input
              type="email"
              [(ngModel)]="formData.email"
              name="email"
              required
              placeholder="alex@empresa.com"
              class="w-full px-4 py-3 bg-zinc-50 border border-zinc-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all placeholder:text-zinc-300"
            />
          </div>

          <div class="space-y-2">
            <label class="text-xs font-semibold text-zinc-500 uppercase tracking-wider"
              >Tipo de Proyecto</label
            >
            <div class="relative">
              <select
                [(ngModel)]="formData.projectType"
                name="projectType"
                required
                class="w-full px-4 py-3 bg-zinc-50 border border-zinc-200 rounded-xl appearance-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-zinc-700"
              >
                <option value="" disabled selected>Selecciona una categoría</option>
                <option value="ecommerce">E-commerce Pack</option>
                <option value="social">Social Media Content</option>
                <option value="editorial">Editorial / High End</option>
              </select>
              <div
                class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-zinc-500"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke="currentColor"
                  class="w-4 h-4"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="m19.5 8.25-7.5 7.5-7.5-7.5"
                  />
                </svg>
              </div>
            </div>
          </div>

          <button
            type="submit"
            [disabled]="!quotationForm.valid || isSubmitting()"
            class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed mt-4 flex items-center justify-center gap-2"
          >
            @if (isSubmitting()) {
              <svg
                class="animate-spin h-5 w-5 text-white"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              <span>Enviando...</span>
            } @else {
              <span>Enviar solicitud</span>
            }
          </button>

          <p class="text-[10px] text-center text-zinc-400 mt-4">
            Al enviar, aceptas nuestras
            <a href="#" class="text-blue-500 underline">Políticas de Privacidad</a>
          </p>
        </form>
      </div>
    } @else {
      <div
        class="p-12 flex flex-col items-center justify-center text-center h-full min-h-[500px] animate-fade-in"
      >
        <div
          class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-8 animate-bounce delay-100"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="3"
            stroke="currentColor"
            class="w-10 h-10"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
          </svg>
        </div>

        <h2 class="text-3xl font-bold text-zinc-900 mb-4 animate-fade-in-up delay-200">
          Solicitud recibida
        </h2>
        <p class="text-zinc-500 mb-10 max-w-xs animate-fade-in-up delay-300">
          Nos pondremos en contacto contigo en breve para dar el siguiente paso en tu proyecto.
        </p>

        <button
          (click)="close()"
          class="px-8 py-3 bg-white border border-blue-600 text-blue-600 font-semibold rounded-full hover:bg-blue-50 transition-colors animate-fade-in-up delay-300"
        >
          Volver al inicio
        </button>
      </div>
    }
  </div>
</div>
